<?xml version="1.0" encoding="UTF-8"?>
<FlowConfiguration>
	<id>arw_3km_run12</id>
	<name>Prepare LaMMa and publish</name>
	<description>Create images from netcdf publish on GeoServer and on GeoNetwork</description>
	
	<corePoolSize>2</corePoolSize>
	<maximumPoolSize>2</maximumPoolSize>
	<keepAliveTime>1500</keepAliveTime>
	<workQueueSize>100</workQueueSize>
	
	<autorun>true</autorun>
	
	<EventGeneratorConfiguration>
		<!--wildCard>*.grb</wildCard-->
		<wildCard>*_arw_ecm_3km_*12.grb</wildCard>
		<watchDirectory>/opt/ingestion/</watchDirectory>
		<!--watchDirectory>arw_3km_run12/in/</watchDirectory-->
		<osType>OS_UNDEFINED</osType>
		<eventType>FILE_ADDED</eventType>
        <interval>0 0/15 1-3 * * ?</interval>
		<id>id</id>
		<serviceID>fsEventGeneratorService</serviceID>
	</EventGeneratorConfiguration>
	<EventConsumerConfiguration>
		<id>LaMMa</id>
		
		<listenerId>LaMMaLogger</listenerId>
		<listenerId>LaMMaCumulator</listenerId>

		<performBackup>false</performBackup>
		<preserveInput>false</preserveInput>
		
		<Netcdf2GeotiffConfiguration>
		        <listenerId>LaMMaLogger</listenerId>
			<listenerId>LaMMaCumulator</listenerId>
			<listenerId>LaMMaStatus</listenerId>

			<overrideConfigDir>./</overrideConfigDir>
			
			<layerParentDirectory>/opt/data/models/arw_3km_run12/</layerParentDirectory>
			<!--layerParentDirectory>/home/carlo/work/project/Lamma/trunk/lamma_2012/GEOBATCH_TEMP_DIR/arw_3km_run12</layerParentDirectory-->
			
			<crs>EPSG:4326</crs>
			<envelope/>
			<metocDictionaryPath>config/lamma-dictionary_awr_ecm_3km.xml</metocDictionaryPath>
			
			<flipY>true</flipY>
			
			<variables>
			  <string>Categorical_freezing_rain</string>
			  <string>Categorical_ice_pellets</string>
			  <string>Categorical_rain</string>
			  <string>Categorical_snow</string>
			  <string>Convective_Avail_Pot_Energy</string>
			  <string>Convective_inhibition</string>
			  <string>Convective_precip_rate</string>
			  <string>Convective_precipitation</string> 									<!-- NON PIU' PRESENTE -->
			  <string>Dew_point_temperature</string>
			  <string>Downward_long_wave_flux</string>
			  <string>Downward_short_wave_flux</string>
			  <string>Geopotential_height</string>
			  <string>Geopotential_height_highest_tropospheric_freezing</string>
			  <string>Geopotential_height_surface</string>
			  <string>Geopotential_height_tropopause</string>
			  <string>High_cloud_cover</string> <!-- AGGIUNTO --> 							<!-- NON INGERITO -->
			  <string>Land_cover_land1sea0</string>
			  <string>Low_cloud_cover</string> <!-- AGGIUNTO -->  							<!-- NON INGERITO -->
			  <string>Mean_sea_level_pressure_NAM_model</string>
			  <string>Medium_cloud_cover</string> <!-- AGGIUNTO --> 						<!-- NON INGERITO -->
			  <string>Precipitation_rate</string> 											<!-- NON PIU' PRESENTE -->
			  <string>Relative_humidity</string>
			  <string>Relative_humidity_height_above_ground</string> <!-- MODIFICATO -->
			  <string>Soil_temperature</string>
			  <string>Surface_wind_gust</string>
			  <string>Temperature</string>
			  <string>Temperature_height_above_ground</string>
			  <string>Temperature_surface</string> <!-- AGGIUNTO -->
			  <string>Total_cloud_cover</string> 											<!-- NON INGERITO -->
			  <string>Total_precipitation</string> 											<!-- NON INGERITO -->
			  <string>u_wind</string>
			  <string>u_wind_height_above_ground</string>
			  <string>v_wind</string>
			  <string>v_wind_height_above_ground</string>
			  <string>Visibility</string>
			  <string>Volumetric_soil_moisture</string>
			</variables>
			
			<serviceID>Netcdf2GeotiffService</serviceID>
			<id>LaMMAARWind_a2</id>
			<description>LaMMAARWind NetCDFCFGeodetic2GeoTIFFs</description>
			<name>LaMMAARWind_a2</name>
		</Netcdf2GeotiffConfiguration>
		
		<ScriptingConfiguration>
			<id>preprocessinggroovy_script</id>
			<description>preprocessing Groovy Script</description>
			<name>preprocessingGroovyScript</name>
			
		        <listenerId>LaMMaLogger</listenerId>
			<listenerId>LaMMaCumulator</listenerId>
			<listenerId>LaMMaStatus</listenerId>

			<serviceID>ScriptingService</serviceID>
			<overrideConfigDir>../</overrideConfigDir>

			<language>groovy</language>
			<scriptFile>commons/categorical.groovy</scriptFile>

			<properties>
				<entry>
				  <string>imageNameRegex</string>
				  <string>[/A-z0-9]+_(.*)\.tiff</string>
				</entry>
				<!-- recognize the IMC to merge -->
				<entry>
				  <string>imcRegex</string>
				  <string>.*_Categorical_.*</string>
				</entry>
				<!--Composing layer name-->
				<entry>
				  <string>outDirName</string>
				  <string>Categorical</string>
				</entry>
				<entry>
				  <string>prefixRegex</string>
				  <string>(arw_3km_).*</string>
				</entry>
				<entry>
				  <string>suffixRegex</string>
				  <string>.*(_[0-9]+T[0-9]+Z)</string>
				</entry>
			</properties>
			
		</ScriptingConfiguration>
		
		<ScriptingConfiguration>
                        <id>wind_height_above_ground__script</id>
                        <description>preprocessing Groovy Script</description>
                        <name>preprocessingGroovyScript</name>

		        <listenerId>LaMMaLogger</listenerId>
			<listenerId>LaMMaCumulator</listenerId>
			<listenerId>LaMMaStatus</listenerId>

                        <serviceID>ScriptingService</serviceID>

                        <overrideConfigDir>../</overrideConfigDir>

                        <language>groovy</language>
                        <scriptFile>commons/wind.groovy</scriptFile>

                        <properties>
				<entry>
				  <string>defaultStyle</string>
				  <string>garrows</string>
				</entry>
                                <entry>
                                  <string>imageNameRegex</string>
                                  <string>[/A-z0-9]+_(.*)\.tiff</string>
                                </entry>
                                <!-- recognize the IMC to merge -->
                                <entry>
                                  <string>imcRegex</string>
                                  <string>.*_wind_height_above_ground_.*</string>
                                </entry>
                                <!--Composing layer name-->
                                <entry>
                                  <string>outDirName</string>
                                  <string>Wind_height_above_ground</string>
                                </entry>
                                <entry>
                                  <string>prefixRegex</string>
                                  <string>(arw_3km_).*</string>
                                </entry>
                                <entry>
                                  <string>suffixRegex</string>
                                  <string>.*(_[0-9]+T[0-9]+Z)</string>
                                </entry>
                        </properties>

                </ScriptingConfiguration>
		<ScriptingConfiguration>
			<id>wind_script</id>
			<description>wind_script</description>
			<name>wind_script</name>			
						
		        <listenerId>LaMMaLogger</listenerId>
			<listenerId>LaMMaCumulator</listenerId>
			<listenerId>LaMMaStatus</listenerId>

			<serviceID>ScriptingService</serviceID>
			
			<overrideConfigDir>../</overrideConfigDir>

			<language>groovy</language>
			<scriptFile>commons/wind.groovy</scriptFile>

                        <properties>
				<entry>
				  <string>defaultStyle</string>
				  <string>garrows</string>
				</entry>
				<entry>
				  <string>imageNameRegex</string>
				  <string>[/A-z0-9]+_(.*)\.tiff</string>
				</entry>
				<!-- recognize the IMC to merge -->
				<entry>
				  <string>imcRegex</string>
				  <string>.*_wind_[0-9]+.*</string>
				</entry>
				<!--Composing layer name-->
				<entry>
				  <string>outDirName</string>
				  <string>Wind</string>
				</entry>
				<entry>
				  <string>prefixRegex</string>
				  <string>(arw_3km_).*</string>
				</entry>
				<entry>
				  <string>suffixRegex</string>
				  <string>.*(_[0-9]+T[0-9]+Z)</string>
				</entry>
			</properties>
			
		</ScriptingConfiguration>

		<ImageMosaicActionConfiguration>
			<overrideConfigDir>./</overrideConfigDir>

		        <listenerId>LaMMaLogger</listenerId>
			<listenerId>LaMMaCumulator</listenerId>
			<listenerId>LaMMaStatus</listenerId>						

			<crs>EPSG:4326</crs>

			<envelope/>
			<dataTransferMethod>EXTERNAL</dataTransferMethod>
			<geoserverUID>admin</geoserverUID>
			<!--geoserverPWD>geoserver</geoserverPWD>
			<geoserverURL>http://localhost:8181/geoserver</geoserverURL-->
			<geoserverPWD>j6Knno8r</geoserverPWD>
			<geoserverURL>http://172.16.1.134:8080/geoserver</geoserverURL>
			<defaultNamespace>ARW_3KM_RUN12</defaultNamespace>
			<defaultStyle>raster</defaultStyle>

			<wmsPath>/</wmsPath>
			<backgroundValue>NaN</backgroundValue>
			<outputTransparentColor/>
			<inputTransparentColor/>
			<allowMultithreading>true</allowMultithreading>
			<useJaiImageRead>false</useJaiImageRead>

			<tileSizeH>256</tileSizeH>
			<tileSizeW>256</tileSizeW>
			<NativeMinBoundingBoxX>4</NativeMinBoundingBoxX>

			<NativeMinBoundingBoxY>40</NativeMinBoundingBoxY>

			<NativeMaxBoundingBoxX>17.98</NativeMaxBoundingBoxX>

			<NativeMaxBoundingBoxY>49</NativeMaxBoundingBoxY>

			<latLonMinBoundingBoxX>4</latLonMinBoundingBoxX>

			<latLonMinBoundingBoxY>40</latLonMinBoundingBoxY>

			<latLonMaxBoundingBoxX>17.98</latLonMaxBoundingBoxX>

			<latLonMaxBoundingBoxY>49</latLonMaxBoundingBoxY>
			<!--NONE, REPROJECT_TO_DECLARED, FORCE_DECLARED-->
			<projectionPolicy>NONE</projectionPolicy>
			<!-- METADATA -->
			<timeDimEnabled>true</timeDimEnabled>
			<!-- LIST, CONTINUOUS_INTERVAL, DISCRETE_INTERVAL -->
			<timePresentationMode>LIST</timePresentationMode>
			<elevDimEnabled>true</elevDimEnabled>
			<elevationPresentationMode>LIST</elevationPresentationMode>
			<!--  <dirName>DIR</dirName>-->
			<styles/>
			
			<!--<datastorePropertiesPath>config/datastore.properties</datastorePropertiesPath>-->
			<timeRegex>[0-9]{8}T[0-9]{9}Z(\?!.\*[0-9]{8}T[0-9]{9}Z.\*)</timeRegex>
			<elevationRegex><![CDATA[(?<=_)(\\d{4}\\.\\d{3})(?=_)]]></elevationRegex>

			<serviceID>ImageMosaicGeneratorService</serviceID>
			<id>ImageMosaicService</id>
			<description>ImageMosaicService</description>
			<name>ImageMosaicService</name>
		</ImageMosaicActionConfiguration>

		<ScriptingConfiguration>
			<id>Script</id>
			<description>Groovy Script</description>
			<name>script</name>
			
		        <listenerId>LaMMaLogger</listenerId>
			<listenerId>LaMMaCumulator</listenerId>
			<listenerId>LaMMaStatus</listenerId>
			
			<serviceID>ScriptingService</serviceID>
			
			<overrideConfigDir>../</overrideConfigDir>

			<language>groovy</language>
			<scriptFile>commons/GeoNetworkAndGeoStore.groovy</scriptFile>
			<properties>
				  <entry>
				    <string>WORKSPACE</string>
				    <string>ARW_3KM_RUN12</string>
				  </entry>
				  
				  <entry>
				    <string>GNPWD</string>
				    <!--string>admin</string-->
				    <string>j6Knno8r</string>
				  </entry>
				  <entry>
				    <string>GNUID</string>
				    <string>admin</string>
				  </entry>
				  <entry>
				    <string>GNURL</string>
				    <!--string>http://localhost:8282/geonetwork/</string-->
				    <string>http://172.16.1.136:8080/geonetwork</string>
				  </entry>
				  <entry>
				    <string>GN_METADATA_TEMPLATE</string>
				    <string>commons/gn_template.xml</string>
				  </entry>
				  
				  
				  <entry>
				    <string>GSTPWD</string>
				    <string>admin</string>
				  </entry>
				  <entry>
				    <string>GSTUID</string>
				    <string>admin</string>
				  </entry>
				  <entry>
				    <string>GSTURL</string>
				    <!--string>http://localhost:8383/geostore/rest/</string-->
				    <string>http://172.16.1.136:8181/geostore/rest/</string>
				  </entry>
				  <entry>
				    <string>GST_METADATA_TEMPLATE</string>
				    <string>commons/gst_template.js</string>
				  </entry>
				  <entry>
				    <string>GST_LAYER_TEMPLATE</string>
				    <string>commons/gst_msg_layer_template.js</string>
				  </entry>
			</properties>
		</ScriptingConfiguration>

		<!--XstreamConfiguration>
			<serviceID>XstreamGeneratorService</serviceID>
			<id>XstreamGeneratorService</id>
			<description>Xstream action</description>
			<name>XstreamConfiguration</name>
		  
			<dirty>false</dirty>

		        <listenerId>LaMMaLogger</listenerId>
			<listenerId>LaMMaCumulator</listenerId>
			<listenerId>LaMMaStatus</listenerId>

			<failIgnored>false</failIgnored>
			
			<overrideConfigDir>./</overrideConfigDir>
			
			<output>out/</output>
		</XstreamConfiguration>
		<FreeMarker>
			<serviceID>FreeMarkerGeneratorService</serviceID>
			<id>FreeMarkerGeneratorService</id>
			<description>description</description>
			<name>FreeMarkerConfiguration</name>
		  
			<dirty>false</dirty>

		        <listenerId>LaMMaLogger</listenerId>
			<listenerId>LaMMaCumulator</listenerId>
			<listenerId>LaMMaStatus</listenerId>

			<failIgnored>false</failIgnored>
			
			<overrideConfigDir>./</overrideConfigDir>
		  
			<input>config/template.xml</input>
			<output>out/</output>
			<nToN>true</nToN>
		</FreeMarker>
		<Geonetwork>
			<serviceID>GeonetworkGeneratorService</serviceID>
			<id>GeonetworkGeneratorService</id>
			<name>GeonetworkConfiguration</name>
			<description>description</description>

		        <listenerId>LaMMaLogger</listenerId>
			<listenerId>LaMMaCumulator</listenerId>
			<listenerId>LaMMaStatus</listenerId>
			
			<dirty>false</dirty>
			<failIgnored>false</failIgnored>
		  
			<overrideConfigDir>./</overrideConfigDir>

			<geonetworkServiceURL>http://172.16.1.136:8080/geonetwork</geonetworkServiceURL>
			<loginPassword>j6Knno8r</loginPassword>
			<loginUsername>admin</loginUsername>
			<onlyMetadataInput>true</onlyMetadataInput>
			<group>1</group>
			<category>_none_</category>
			<styleSheet>_none_</styleSheet>
			<validate>false</validate>
		</Geonetwork-->
		
		<GeoServerReloadConfiguration>
			<serviceID>GeoServerReloadService</serviceID>
			<id>GeoServerReloadAction</id>
			<name>GeoServerReloadAction</name>
			<description>GeoServerReload</description>

		        <listenerId>LaMMaLogger</listenerId>
			<listenerId>LaMMaCumulator</listenerId>
			<listenerId>LaMMaStatus</listenerId>
			
			<dirty>false</dirty>
			<failIgnored>false</failIgnored>
		  
			
			<geoserverList>/opt/GEOBATCH_DATA_DIR/commons/GeoServerList.xml</geoserverList>
			
			<!--geoserverList>/home/carlo/work/project/Lamma/trunk/lamma_2012/GEOBATCH_CONFIG_DIR/commons/GeoServerList.xml</geoserverList-->
			<executorSize>10</executorSize>
			
			<overrideConfigDir>./</overrideConfigDir>
			
		</GeoServerReloadConfiguration>

	</EventConsumerConfiguration>
	<ListenerConfigurations>
		<LoggingProgressListener>
			<serviceID>loggingListenerService</serviceID>
			<id>LaMMaLogger</id>
			<loggerName>it.geosolutions.geobatch</loggerName>
		</LoggingProgressListener>
		<CumulatingProgressListener>
			<serviceID>cumulatingListenerService</serviceID>
			<id>LaMMaCumulator</id>
		</CumulatingProgressListener>
		<StatusProgressListener>
			<serviceID>statusListenerService</serviceID>
			<id>LaMMaStatus</id>
		</StatusProgressListener>
	</ListenerConfigurations>
</FlowConfiguration>
